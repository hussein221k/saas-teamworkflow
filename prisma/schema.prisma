generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}


// ==============================
// Enums
// ==============================

enum Role {
  ADMIN
  EMPLOYEE
}

enum TaskStatus {
  PENDING
  IN_PROGRESS
  DONE
  OVERDUE
}

enum Plan {
  FREE
  PRO
  ENTERPRISE
}

enum BillingStatus {
  ACTIVE
  EXPIRED
  CANCELED
}

// ==============================
// User
// ==============================

model User {
  id       Int    @id @default(autoincrement())
  name     String
  email    String? @unique
  username String? @unique
  employeeCode String? @unique
  password String
  role     Role   @default(EMPLOYEE)

  teamId Int?
  createdById Int?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // ðŸ”¹ Team membership
  team Team? @relation("TeamMembers", fields: [teamId], references: [id])

  // ðŸ”¹ Team ownership (Admin)
  ownedTeams Team[] @relation("TeamOwner")

  // ðŸ”¹ User creator (self relation)
  createdBy    User?  @relation("UserCreator", fields: [createdById], references: [id])
  createdUsers User[] @relation("UserCreator")

  // ðŸ”¹ Tasks
  tasksCreated  Task[] @relation("CreatedTasks")
  tasksAssigned Task[] @relation("AssignedTasks")

  // ðŸ”¹ Comments
  comments Comment[]
  messages Message[]
}

// ==============================
// Team
// ==============================

model Team {
  id        Int      @id @default(autoincrement())
  name      String
  ownerId   Int
  createdAt DateTime @default(now())

  // ðŸ”¹ Owner (Admin)
  owner User @relation("TeamOwner", fields: [ownerId], references: [id])

  // ðŸ”¹ Members
  users User[] @relation("TeamMembers")

  tasks    Task[]
  messages Message[]
  channels Channel[]
  projects Project[]
  billing  Billing?
  themeColor String @default("#6366f1")
  inviteCode String? @unique
}

model Project {
  id        Int      @id @default(autoincrement())
  name      String
  teamId    Int
  createdAt DateTime @default(now())

  team      Team     @relation(fields: [teamId], references: [id])
}


model Channel {
  id        Int      @id @default(autoincrement())
  name      String
  teamId    Int
  createdAt DateTime @default(now())

  team     Team      @relation(fields: [teamId], references: [id])
  messages Message[]
}

// ==============================
// Billing (Team only)
// ==============================

model Billing {
  id     Int           @id @default(autoincrement())
  teamId Int           @unique
  plan   Plan          @default(FREE)
  status BillingStatus @default(ACTIVE)

  startedAt DateTime  @default(now())
  endsAt    DateTime?

  team Team @relation(fields: [teamId], references: [id])
}

// ==============================
// Task
// ==============================

model Task {
  id          Int        @id @default(autoincrement())
  title       String
  description String
  status      TaskStatus @default(PENDING)
  deadline    DateTime?

  teamId       Int
  createdById  Int
  assignedToId Int?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  team Team @relation(fields: [teamId], references: [id])

  createdBy  User  @relation("CreatedTasks", fields: [createdById], references: [id])
  assignedTo User? @relation("AssignedTasks", fields: [assignedToId], references: [id])

  comments Comment[]
}

// ==============================
// Comment
// ==============================

model Comment {
  id      Int    @id @default(autoincrement())
  content String

  taskId Int
  userId Int

  createdAt DateTime @default(now())

  task Task @relation(fields: [taskId], references: [id])
  user User @relation(fields: [userId], references: [id])
}

// ==============================
// Message (Team Chat)
// ==============================

model Message {
  id        Int      @id @default(autoincrement())
  content   String

  channelId Int?
  teamId    Int
  userId    Int

  createdAt DateTime @default(now())

  channel Channel? @relation(fields: [channelId], references: [id])
  team    Team    @relation(fields: [teamId], references: [id])
  user    User    @relation(fields: [userId], references: [id])
}
